<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <title>Valentine Proposal</title>
  <link rel="manifest" href="/manifest.json" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600;700&family=Inter:wght@300;400;500;600;700&display=swap"
    rel="stylesheet"
  />
  <style>
    :root {
      --black: #000000;
      --rose: #b76e79;
      --champagne: #f4e4c1;
      --white: #fafafa;
      --glass: rgba(20, 20, 20, 0.6);
      --glass-border: rgba(255, 255, 255, 0.08);
      --glow: rgba(183, 110, 121, 0.45);
      --shadow: rgba(0, 0, 0, 0.45);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Inter", system-ui, sans-serif;
      background: radial-gradient(circle at top, rgba(183, 110, 121, 0.15), transparent 55%),
        radial-gradient(circle at 10% 20%, rgba(244, 228, 193, 0.12), transparent 50%),
        #030303;
      color: var(--white);
      min-height: 100vh;
      overflow-x: hidden;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    #root {
      position: relative;
      z-index: 1;
    }

    canvas.particles {
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
    }

    .gradient-text {
      background: linear-gradient(120deg, var(--champagne), var(--rose));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shimmer 6s ease infinite;
      background-size: 200% 200%;
    }

    @keyframes shimmer {
      0% {
        background-position: 0% 50%;
      }
      50% {
        background-position: 100% 50%;
      }
      100% {
        background-position: 0% 50%;
      }
    }

    .page {
      display: flex;
      flex-direction: column;
      gap: 120px;
      padding: 72px 6vw 120px;
      position: relative;
    }

    header.hero {
      min-height: 90vh;
      display: grid;
      gap: 48px;
      align-items: center;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }

    h1, h2, h3 {
      font-family: "Playfair Display", serif;
    }

    h1 {
      font-size: clamp(2.8rem, 5vw, 4.8rem);
      line-height: 1.05;
    }

    h2 {
      font-size: clamp(2rem, 3.2vw, 3.2rem);
    }

    .eyebrow {
      letter-spacing: 0.3em;
      text-transform: uppercase;
      font-size: 0.72rem;
      color: var(--champagne);
      font-weight: 600;
    }

    .glass {
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 24px;
      box-shadow: 0 30px 70px var(--shadow);
      backdrop-filter: blur(16px);
    }

    .hero-card {
      padding: 32px;
      display: grid;
      gap: 20px;
    }

    .heart {
      width: 90px;
      height: 90px;
      display: grid;
      place-items: center;
      border-radius: 30px;
      background: radial-gradient(circle at top, rgba(244, 228, 193, 0.2), transparent 60%),
        rgba(183, 110, 121, 0.15);
      border: 1px solid rgba(183, 110, 121, 0.35);
      box-shadow: 0 0 30px rgba(183, 110, 121, 0.4);
      font-size: 2.3rem;
      animation: pulse 2.4s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.08); }
    }

    .scroll-indicator {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.9rem;
      color: rgba(250, 250, 250, 0.7);
      margin-top: 18px;
    }

    .scroll-indicator span {
      width: 32px;
      height: 52px;
      border-radius: 999px;
      border: 1px solid rgba(250, 250, 250, 0.3);
      position: relative;
      display: inline-block;
    }

    .scroll-indicator span::after {
      content: "";
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 6px;
      height: 6px;
      background: var(--champagne);
      border-radius: 50%;
      animation: scroll 1.6s ease-in-out infinite;
    }

    @keyframes scroll {
      0% { opacity: 0; transform: translate(-50%, 0); }
      50% { opacity: 1; }
      100% { opacity: 0; transform: translate(-50%, 18px); }
    }

    .cta-row {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      margin-top: 28px;
    }

    .btn {
      border: none;
      cursor: pointer;
      padding: 14px 28px;
      border-radius: 999px;
      font-weight: 600;
      font-size: 0.95rem;
      position: relative;
      overflow: hidden;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, #8f515a, var(--rose));
      color: var(--white);
      box-shadow: 0 16px 30px rgba(183, 110, 121, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 22px 40px rgba(183, 110, 121, 0.55);
    }

    .btn-outline {
      background: transparent;
      border: 1px solid rgba(244, 228, 193, 0.3);
      color: var(--champagne);
    }

    .section {
      display: grid;
      gap: 36px;
    }

    .timeline {
      display: grid;
      gap: 28px;
      position: relative;
    }

    .parallax-orb {
      position: absolute;
      right: 10%;
      top: -40px;
      width: 220px;
      height: 220px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(244, 228, 193, 0.18), transparent 70%);
      filter: blur(2px);
      z-index: 0;
    }

    .timeline::before {
      content: "";
      position: absolute;
      left: 18px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: linear-gradient(180deg, rgba(183, 110, 121, 0.6), rgba(244, 228, 193, 0.2));
    }

    .timeline-item {
      display: grid;
      grid-template-columns: 44px 1fr;
      gap: 20px;
      align-items: start;
      position: relative;
    }

    .timeline-dot {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--rose);
      box-shadow: 0 0 0 8px rgba(183, 110, 121, 0.2);
      margin-top: 6px;
      margin-left: 11px;
    }

    .timeline-card {
      padding: 22px;
      border-radius: 20px;
      background: rgba(8, 8, 8, 0.7);
      border: 1px solid rgba(244, 228, 193, 0.12);
      display: grid;
      gap: 12px;
      position: relative;
      z-index: 1;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .timeline-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 18px 35px rgba(0, 0, 0, 0.4);
    }

    .image-placeholder {
      height: 150px;
      border-radius: 16px;
      background: linear-gradient(140deg, rgba(244, 228, 193, 0.2), rgba(183, 110, 121, 0.2));
      border: 1px dashed rgba(244, 228, 193, 0.4);
      display: grid;
      place-items: center;
      color: rgba(250, 250, 250, 0.7);
      font-size: 0.95rem;
      width: 100%;
      object-fit: cover;
    }

    .quiz-grid {
      display: grid;
      gap: 24px;
    }

    .quiz-card {
      padding: 22px;
      border-radius: 20px;
      background: rgba(10, 10, 10, 0.75);
      border: 1px solid rgba(244, 228, 193, 0.1);
      display: grid;
      gap: 14px;
      position: relative;
    }

    .options {
      display: grid;
      gap: 10px;
    }

    .option {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(255, 255, 255, 0.02);
      cursor: pointer;
      transition: border 0.2s ease, transform 0.2s ease;
    }

    .option.selected {
      border-color: rgba(244, 228, 193, 0.4);
      transform: translateY(-2px);
      box-shadow: 0 0 20px rgba(183, 110, 121, 0.2);
    }

    .option.correct {
      border-color: rgba(244, 228, 193, 0.7);
      background: rgba(244, 228, 193, 0.12);
    }

    .option.flip {
      transform: rotateY(12deg);
    }

    .option.media {
      flex-direction: column;
      align-items: flex-start;
      gap: 10px;
    }

    .media-thumb {
      width: 100%;
      height: 100px;
      border-radius: 12px;
      background: linear-gradient(140deg, rgba(244, 228, 193, 0.2), rgba(183, 110, 121, 0.2));
      border: 1px solid rgba(244, 228, 193, 0.2);
      display: grid;
      place-items: center;
      font-size: 0.9rem;
      transition: transform 0.3s ease;
    }

    .media-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 10px;
    }

    .option.media:hover .media-thumb {
      transform: scale(1.05);
    }

    .emoji-bounce {
      display: inline-block;
      animation: bounce 2s ease-in-out infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }

    .coffee-spin {
      display: inline-block;
      animation: steam 2.6s ease-in-out infinite;
    }

    @keyframes steam {
      0%, 100% { transform: rotate(0deg); }
      50% { transform: rotate(-6deg); }
    }

    .progress-bar {
      height: 6px;
      width: 100%;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.08);
      overflow: hidden;
    }

    .progress-bar span {
      display: block;
      height: 100%;
      background: linear-gradient(90deg, var(--rose), var(--champagne));
      width: 0;
    }

    .question-meta {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      color: rgba(250, 250, 250, 0.7);
    }

    .big-question {
      min-height: 70vh;
      display: grid;
      place-items: center;
      text-align: center;
      gap: 28px;
    }

    .big-question .buttons {
      position: relative;
      height: 120px;
      width: min(520px, 90vw);
      margin: 0 auto;
    }

    .no-btn {
      position: absolute;
      right: 0;
      top: 40px;
      background: rgba(255, 255, 255, 0.12);
      color: rgba(255, 255, 255, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 10px 22px;
      border-radius: 999px;
      font-size: 0.85rem;
    }

    .yes-btn {
      position: absolute;
      left: 0;
      top: 20px;
      padding: 16px 42px;
      font-size: 1.05rem;
      border-radius: 999px;
      background: linear-gradient(135deg, #7b404a, var(--rose), var(--champagne));
      color: var(--black);
      box-shadow: 0 20px 40px rgba(183, 110, 121, 0.5);
    }

    .reveal {
      display: grid;
      gap: 28px;
    }

    .gallery {
      display: grid;
      gap: 16px;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    }

    .gallery-item {
      height: 180px;
      border-radius: 18px;
      background: linear-gradient(130deg, rgba(244, 228, 193, 0.2), rgba(183, 110, 121, 0.2));
      border: 1px solid rgba(244, 228, 193, 0.2);
      display: grid;
      place-items: center;
      font-size: 0.95rem;
    }

    .carousel {
      display: grid;
      gap: 16px;
    }

    .carousel-frame {
      position: relative;
      height: 240px;
      border-radius: 20px;
      overflow: hidden;
      border: 1px solid rgba(244, 228, 193, 0.2);
      background: rgba(255, 255, 255, 0.04);
    }

    .carousel-frame img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .carousel-controls {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 8px 16px;
      border-radius: 999px;
      background: rgba(244, 228, 193, 0.08);
      border: 1px solid rgba(244, 228, 193, 0.25);
      font-size: 0.85rem;
    }

    .toolbar {
      position: fixed;
      top: 24px;
      right: 24px;
      display: flex;
      gap: 12px;
      z-index: 10;
    }

    .toolbar button {
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 0.8rem;
      background: rgba(255, 255, 255, 0.08);
      color: var(--white);
      border: 1px solid rgba(255, 255, 255, 0.18);
      cursor: pointer;
    }

    .hidden-gallery {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      display: grid;
      place-items: center;
      z-index: 20;
    }

    .hidden-gallery .panel {
      max-width: 720px;
      width: 90vw;
      padding: 28px;
      border-radius: 24px;
      background: rgba(10, 10, 10, 0.9);
      border: 1px solid rgba(244, 228, 193, 0.2);
      display: grid;
      gap: 18px;
    }

    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: rgba(10, 10, 10, 0.8);
      border: 1px solid rgba(244, 228, 193, 0.2);
      padding: 12px 18px;
      border-radius: 12px;
      z-index: 12;
      font-size: 0.9rem;
    }

    .progress-indicator {
      position: fixed;
      left: 0;
      top: 0;
      height: 4px;
      width: 100%;
      z-index: 15;
      background: rgba(255, 255, 255, 0.08);
    }

    .progress-indicator span {
      display: block;
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, var(--rose), var(--champagne));
    }

    @media (max-width: 720px) {
      .page {
        padding: 48px 6vw 96px;
        gap: 96px;
      }

      .big-question .buttons {
        height: 150px;
      }
    }
  </style>
</head>
<body>
  <canvas class="particles" id="particles"></canvas>
  <div id="root"></div>
  <script type="module">
    import React, { useEffect, useMemo, useRef, useState } from "https://esm.sh/react@18.2.0";
    import { createRoot } from "https://esm.sh/react-dom@18.2.0/client";
    import { HashRouter, Routes, Route, useNavigate } from "https://esm.sh/react-router-dom@6.22.3";
    import { motion, AnimatePresence } from "https://esm.sh/framer-motion@10.18.0";
    import { Link, Element, scroller } from "https://esm.sh/react-scroll@1.9.0";
    import confetti from "https://esm.sh/canvas-confetti@1.9.3";
    import { jsPDF } from "https://esm.sh/jspdf@2.5.1";

    const STORAGE_KEY = "valentine-quiz";

    const quizQuestions = [
      {
        id: 1,
        text: "What's your favorite color?",
        options: ["Red", "Pink", "Black", "White"],
        correct: ["Black"],
        success: "You know me so well! üñ§",
      },
      {
        id: 2,
        text: "Our favorite series to binge together?",
        options: ["Friends", "Breaking Bad", "Stranger Things", "The Office"],
        correct: ["Stranger Things"],
        flip: true,
      },
      {
        id: 3,
        text: "Which places have you explored?",
        options: ["Kodaikanal", "Kerala", "Ooty", "Goa"],
        correct: ["Kodaikanal", "Kerala"],
        multi: true,
        icons: ["üèîÔ∏è", "üå¥", "üåßÔ∏è", "üåä"],
      },
      {
        id: 4,
        text: "Your seafood preference?",
        options: ["üêü Fish", "ü¶ê Prawns", "ü¶Ä Crab", "ü¶ë Squid"],
        correct: ["ü¶ê Prawns"],
      },
      {
        id: 5,
        text: "Your dream car?",
        options: ["Brezza", "Grand Vitara", "Hyryder"],
        correct: ["Grand Vitara"],
        images: true,
      },
      {
        id: 6,
        text: "My favorite snack when we watch movies?",
        options: ["Popcorn", "Chips", "Nachos", "Chocolate"],
        correct: { base: "Popcorn", followUp: "Butter" },
        followUp: {
          question: "What flavor?",
          options: ["Caramel", "Butter", "Cheese"],
        },
      },
      {
        id: 7,
        text: "Your go-to beverage?",
        options: ["Coffee", "Tea", "Juice", "Smoothie"],
        correct: ["Coffee"],
        icon: "‚òï",
      },
      {
        id: 8,
        text: "Your perfect dress size for that special outfit I'm planning?",
        options: ["XS", "S", "M", "L"],
        correct: ["S"],
        icon: "üëó",
      },
      {
        id: 9,
        text: "Your favorite cuisine?",
        options: ["Italian", "Korean", "Indian", "Chinese"],
        correct: ["Korean"],
        icon: "üçú",
      },
    ];

    const placeholderImage = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='600' height='400'%3E%3Crect width='600' height='400' fill='%23080808'/%3E%3Cpath d='M0 300 C120 260 240 360 360 320 C480 280 540 360 600 320 L600 400 L0 400 Z' fill='%23b76e79' opacity='0.4'/%3E%3Ccircle cx='480' cy='120' r='80' fill='%23f4e4c1' opacity='0.35'/%3E%3C/svg%3E";
    const carImages = {
      Brezza: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='520' height='300'%3E%3Crect width='520' height='300' fill='%23060606'/%3E%3Cpath d='M80 190 L140 120 H320 L380 190 Z' fill='%23b76e79'/%3E%3Crect x='120' y='150' width='70' height='40' fill='%23f4e4c1' opacity='0.4'/%3E%3Crect x='230' y='150' width='70' height='40' fill='%23f4e4c1' opacity='0.4'/%3E%3Ccircle cx='160' cy='205' r='22' fill='%23000000' stroke='%23f4e4c1' stroke-width='4'/%3E%3Ccircle cx='320' cy='205' r='22' fill='%23000000' stroke='%23f4e4c1' stroke-width='4'/%3E%3C/svg%3E",
      "Grand Vitara": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='520' height='300'%3E%3Crect width='520' height='300' fill='%23060606'/%3E%3Cpath d='M60 190 L140 110 H360 L440 190 Z' fill='%23f4e4c1'/%3E%3Crect x='130' y='145' width='80' height='45' fill='%23b76e79' opacity='0.45'/%3E%3Crect x='250' y='145' width='80' height='45' fill='%23b76e79' opacity='0.45'/%3E%3Ccircle cx='170' cy='210' r='24' fill='%23000000' stroke='%23b76e79' stroke-width='4'/%3E%3Ccircle cx='340' cy='210' r='24' fill='%23000000' stroke='%23b76e79' stroke-width='4'/%3E%3C/svg%3E",
      Hyryder: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='520' height='300'%3E%3Crect width='520' height='300' fill='%23060606'/%3E%3Cpath d='M70 190 L150 120 H350 L430 190 Z' fill='%23b76e79'/%3E%3Crect x='140' y='148' width='70' height='40' fill='%23f4e4c1' opacity='0.4'/%3E%3Crect x='250' y='148' width='70' height='40' fill='%23f4e4c1' opacity='0.4'/%3E%3Ccircle cx='170' cy='210' r='22' fill='%23000000' stroke='%23f4e4c1' stroke-width='4'/%3E%3Ccircle cx='330' cy='210' r='22' fill='%23000000' stroke='%23f4e4c1' stroke-width='4'/%3E%3C/svg%3E"
    };

    const gallerySlides = [
      { label: "Golden hour", src: placeholderImage },
      { label: "Coffee dates", src: placeholderImage },
      { label: "Movie night", src: placeholderImage },
      { label: "Road trip", src: placeholderImage },
    ];

    const ripple = (event) => {
      const button = event.currentTarget;
      const circle = document.createElement("span");
      const diameter = Math.max(button.clientWidth, button.clientHeight);
      const radius = diameter / 2;
      circle.style.width = `${diameter}px`;
      circle.style.height = `${diameter}px`;
      circle.style.left = `${event.clientX - button.getBoundingClientRect().left - radius}px`;
      circle.style.top = `${event.clientY - button.getBoundingClientRect().top - radius}px`;
      circle.style.position = "absolute";
      circle.style.borderRadius = "50%";
      circle.style.background = "rgba(255, 255, 255, 0.35)";
      circle.style.transform = "scale(0)";
      circle.style.opacity = "0.8";
      circle.style.pointerEvents = "none";
      circle.style.animation = "ripple 0.6s ease";
      button.appendChild(circle);
      circle.addEventListener("animationend", () => circle.remove());
    };

    const useKonami = (onMatch) => {
      useEffect(() => {
        const seq = ["ArrowUp", "ArrowUp", "ArrowDown", "ArrowDown", "ArrowLeft", "ArrowRight", "ArrowLeft", "ArrowRight", "b", "a"];
        let index = 0;
        const handler = (event) => {
          if (event.key.toLowerCase() === seq[index].toLowerCase()) {
            index += 1;
            if (index === seq.length) {
              index = 0;
              onMatch();
            }
          } else {
            index = 0;
          }
        };
        window.addEventListener("keydown", handler);
        return () => window.removeEventListener("keydown", handler);
      }, [onMatch]);
    };

    const Particles = () => {
      useEffect(() => {
        const canvas = document.getElementById("particles");
        const ctx = canvas.getContext("2d");
        let width = (canvas.width = window.innerWidth);
        let height = (canvas.height = window.innerHeight);
        const hearts = Array.from({ length: 40 }).map(() => ({
          x: Math.random() * width,
          y: Math.random() * height,
          speed: 0.2 + Math.random() * 0.6,
          size: 8 + Math.random() * 12,
          alpha: 0.15 + Math.random() * 0.3,
        }));

        const render = () => {
          ctx.clearRect(0, 0, width, height);
          hearts.forEach((h) => {
            h.y -= h.speed;
            if (h.y < -20) {
              h.y = height + 20;
              h.x = Math.random() * width;
            }
            ctx.fillStyle = `rgba(183, 110, 121, ${h.alpha})`;
            ctx.beginPath();
            ctx.arc(h.x, h.y, h.size / 2.2, 0, Math.PI * 2);
            ctx.fill();
          });
          requestAnimationFrame(render);
        };

        const onResize = () => {
          width = (canvas.width = window.innerWidth);
          height = (canvas.height = window.innerHeight);
        };

        window.addEventListener("resize", onResize);
        render();
        return () => window.removeEventListener("resize", onResize);
      }, []);
      return null;
    };

    const QuizCard = ({ question, index, total, answers, setAnswers }) => {
      const selection = answers[question.id] || (question.followUp ? { base: null, followUp: null } : []);

      const toggleOption = (option) => {
        setAnswers((prev) => {
          const current = prev[question.id] || (question.followUp ? { base: null, followUp: null } : []);
          let next;
          if (question.followUp) {
            if (question.followUp.options.includes(option)) {
              next = { ...current, followUp: option };
            } else {
              next = { base: option, followUp: current.followUp };
            }
          } else if (question.multi) {
            next = current.includes(option) ? current.filter((item) => item !== option) : [...current, option];
          } else {
            next = [option];
          }
          return { ...prev, [question.id]: next };
        });
      };

      const isCorrect = question.followUp
        ? selection.base === question.correct.base && selection.followUp === question.correct.followUp
        : selection.length > 0 && selection.every((item) => question.correct.includes(item)) && question.correct.length === selection.length;

      return (
        <motion.div
          className="quiz-card"
          initial={{ opacity: 0, y: 20 }}
          whileInView={{ opacity: 1, y: 0 }}
          viewport={{ once: true }}
          transition={{ duration: 0.6 }}
        >
          <div className="question-meta">
            <span>Question {index + 1} of {total}</span>
            <span>
              {question.icon ? (
                <span className={question.icon === "‚òï" ? "coffee-spin" : "emoji-bounce"}>{question.icon}</span>
              ) : (
                ""
              )}
            </span>
          </div>
          <h3>{question.text}</h3>
          <div className="options">
            {question.options.map((option, optionIndex) => {
              const selected = question.followUp ? selection.base === option : selection.includes(option);
              const classes = [
                "option",
                question.images ? "media" : "",
                selected ? "selected" : "",
                question.flip && selected ? "flip" : "",
                isCorrect && selected ? "correct" : "",
              ].join(" ");
              return (
                <button
                  type="button"
                  key={option}
                  className={classes}
                  onClick={(event) => {
                    ripple(event);
                    toggleOption(option);
                  }}
                >
                  {question.images ? (
                    <>
                      <div className="media-thumb">
                        <img src={carImages[option] || placeholderImage} alt={`${option} car`} loading="lazy" />
                      </div>
                      <span>{option}</span>
                    </>
                  ) : (
                    <span>
                      {question.icons ? `${question.icons[optionIndex]} ${option}` : option}
                    </span>
                  )}
                  {selected ? <span>‚úì</span> : <span></span>}
                </button>
              );
            })}
          </div>
          {question.success && isCorrect ? <p className="pill">{question.success}</p> : null}
          {question.followUp && selection.base === "Popcorn" ? (
            <div className="options" style={{ marginTop: "10px" }}>
              <p style={{ fontSize: "0.9rem", color: "rgba(250,250,250,0.75)" }}>{question.followUp.question}</p>
              {question.followUp.options.map((option) => {
                const selected = selection.followUp === option;
                return (
                  <button
                    type="button"
                    key={option}
                    className={`option ${selected ? "selected" : ""}`}
                    onClick={(event) => {
                      ripple(event);
                      toggleOption(option);
                    }}
                  >
                    {option}
                  </button>
                );
              })}
            </div>
          ) : null}
        </motion.div>
      );
    };

    const Home = () => {
      const [answers, setAnswers] = useState(() => {
        const stored = localStorage.getItem(STORAGE_KEY);
        return stored ? JSON.parse(stored) : {};
      });
      const [showReveal, setShowReveal] = useState(false);
      const [noAttempts, setNoAttempts] = useState(0);
      const [noHidden, setNoHidden] = useState(false);
      const [noPos, setNoPos] = useState({ x: 0, y: 40, scale: 1 });
      const [toast, setToast] = useState("");
      const [secretOpen, setSecretOpen] = useState(false);
      const [musicOn, setMusicOn] = useState(false);
      const [progress, setProgress] = useState(0);
      const questionText = "Will You Be My Valentine? üíç";
      const [typedText, setTypedText] = useState("");
      const [galleryIndex, setGalleryIndex] = useState(0);
      const navigate = useNavigate();
      const audioRef = useRef(null);
      const parallaxRef = useRef(null);

      useEffect(() => {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(answers));
      }, [answers]);

      useEffect(() => {
        const onScroll = () => {
          const height = document.body.scrollHeight - window.innerHeight;
          const scrolled = height > 0 ? (window.scrollY / height) * 100 : 0;
          setProgress(scrolled);
          if (parallaxRef.current) {
            const offset = window.scrollY * 0.08;
            parallaxRef.current.style.transform = `translateY(${offset}px)`;
          }
        };
        window.addEventListener("scroll", onScroll);
        onScroll();
        return () => window.removeEventListener("scroll", onScroll);
      }, []);

      useEffect(() => {
        let index = 0;
        setTypedText("");
        const timer = setInterval(() => {
          index += 1;
          setTypedText(questionText.slice(0, index));
          if (index >= questionText.length) {
            clearInterval(timer);
          }
        }, 80);
        return () => clearInterval(timer);
      }, [questionText]);

      useKonami(() => {
        setSecretOpen(true);
        setToast("Secret unlocked: Hidden gallery revealed ‚ú®");
        navigate("/gallery");
      });

      const totalQuestions = quizQuestions.length;
      const score = useMemo(() => {
        return quizQuestions.reduce((acc, q) => {
          const selection = answers[q.id] || (q.followUp ? { base: null, followUp: null } : []);
          const correct = q.followUp
            ? selection.base === q.correct.base && selection.followUp === q.correct.followUp
            : selection.length > 0 && selection.every((item) => q.correct.includes(item)) && q.correct.length === selection.length;
          return acc + (correct ? 1 : 0);
        }, 0);
      }, [answers]);

      const handleYes = () => {
        confetti({
          particleCount: 180,
          spread: 90,
          origin: { y: 0.6 },
          colors: ["#b76e79", "#f4e4c1", "#ffffff"],
        });
        setShowReveal(true);
        setToast("She said YES! üíç");
        scroller.scrollTo("reveal", { smooth: true, offset: -40, duration: 800 });
        if (musicOn && audioRef.current) {
          audioRef.current.play().catch(() => {});
        }
      };

      const moveNo = () => {
        if (noHidden) return;
        const attempts = noAttempts + 1;
        setNoAttempts(attempts);
        if (attempts >= 5) {
          setNoHidden(true);
          setToast("Oops! Looks like NO isn't an option! üòÑ");
          return;
        }
        const x = Math.random() * 260;
        const y = 10 + Math.random() * 70;
        const scale = Math.max(0.6, 1 - attempts * 0.1);
        setNoPos({ x, y, scale });
        if (attempts === 4) {
          setToast("Error 404: 'NO' not found in our love story! ‚ù§Ô∏è");
        }
      };

      const handleShare = async () => {
        const shareData = {
          title: "Our Valentine Story",
          text: "A journey to forever. Will you be my Valentine?",
          url: window.location.href,
        };
        if (navigator.share) {
          await navigator.share(shareData);
        } else {
          await navigator.clipboard.writeText(window.location.href);
          setToast("Link copied to clipboard! üíå");
        }
      };

      const handleDownload = () => {
        const doc = new jsPDF();
        doc.setFont("times", "normal");
        doc.text("Our Memories", 20, 20);
        doc.setFontSize(12);
        doc.text(
          [
            "From that first day on October 12,",
            "To our special November 20,",
            "Every coffee date, every Stranger Things episode,",
            "Every adventure from Kodaikanal to Kerala,",
            "Every moment with you has been perfect.",
            "",
            "You're my favorite person,",
            "My Korean food buddy,",
            "My Sirai movie partner,",
            "My everything.",
          ],
          20,
          40
        );
        doc.save("our-memories.pdf");
      };

      const nextSlide = () => {
        setGalleryIndex((prev) => (prev + 1) % gallerySlides.length);
      };

      const prevSlide = () => {
        setGalleryIndex((prev) => (prev - 1 + gallerySlides.length) % gallerySlides.length);
      };

      const toggleMusic = () => {
        setMusicOn((prev) => !prev);
        if (!musicOn && audioRef.current) {
          audioRef.current.play().catch(() => {});
        } else if (audioRef.current) {
          audioRef.current.pause();
        }
      };

      return (
        <div className="page">
          <div className="progress-indicator">
            <span style={{ width: `${progress}%` }}></span>
          </div>

          <div className="toolbar">
            <button onClick={toggleMusic}>{musicOn ? "Music: On" : "Music: Off"}</button>
            <button onClick={() => scroller.scrollTo("quiz", { smooth: true, offset: -40 })}>Quiz</button>
          </div>

          <header className="hero" onDoubleClick={() => navigate("/gallery")}> 
            <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 1 }}>
              <span className="eyebrow">Valentine's Day</span>
              <h1 className="gradient-text">A Journey to Forever...</h1>
              <p style={{ lineHeight: 1.7, fontSize: "1.05rem", maxWidth: "520px", marginTop: "16px" }}>
                A premium black-and-rose-gold love story, crafted for the woman who made every day feel like a promise.
              </p>
              <div className="cta-row">
                <Link to="timeline" smooth={true} offset={-40} duration={600}>
                  <button className="btn btn-primary" onClick={ripple}>Our story</button>
                </Link>
                <Link to="question" smooth={true} offset={-40} duration={600}>
                  <button className="btn btn-outline" onClick={ripple}>The big question</button>
                </Link>
              </div>
              <div className="scroll-indicator">
                <span></span>
                <p>Scroll to explore the memories</p>
              </div>
            </motion.div>

            <motion.div className="hero-card glass" initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2, duration: 1 }}>
              <div className="heart">‚ù§</div>
              <h3>To my forever Valentine</h3>
              <p style={{ lineHeight: 1.7, color: "rgba(250,250,250,0.8)" }}>
                Every look, every laugh, every whispered dream ‚Äî all of it has been leading to this moment.
              </p>
              <div className="pill">With all my love</div>
            </motion.div>
          </header>

          <Element name="timeline" className="section">
            <motion.div initial={{ opacity: 0, y: 30 }} whileInView={{ opacity: 1, y: 0 }} viewport={{ once: true }} transition={{ duration: 0.8 }}>
              <h2 className="gradient-text">Our Story Timeline</h2>
              <p style={{ marginTop: "12px", maxWidth: "620px", lineHeight: 1.7 }}>
                A vertical timeline of every unforgettable chapter ‚Äî the first spark, the special day, and the moments that made us.
              </p>
            </motion.div>
            <div className="timeline">
              <div className="parallax-orb" ref={parallaxRef}></div>
              <motion.div className="timeline-item" initial={{ opacity: 0, x: -20 }} whileInView={{ opacity: 1, x: 0 }} viewport={{ once: true }}>
                <div className="timeline-dot"></div>
                <div className="timeline-card">
                  <h3>October 12: The Day We First Met üí´</h3>
                  <img className="image-placeholder" src={placeholderImage} alt="First meeting placeholder" loading="lazy" />
                  <p>That very first hello felt like destiny in disguise ‚Äî calm, bright, unforgettable.</p>
                </div>
              </motion.div>
              <motion.div className="timeline-item" initial={{ opacity: 0, x: -20 }} whileInView={{ opacity: 1, x: 0 }} viewport={{ once: true }}>
                <div className="timeline-dot"></div>
                <div
                  className="timeline-card"
                  onMouseEnter={() => confetti({ particleCount: 60, spread: 60, origin: { y: 0.6 }, colors: ['#b76e79', '#f4e4c1'] })}
                >
                  <h3>November 20: Our Special Day üíï</h3>
                  <img className="image-placeholder" src={placeholderImage} alt="Special day placeholder" loading="lazy" />
                  <p>Our promise became real ‚Äî a day wrapped in joy, glow, and the kind of love that feels like home.</p>
                </div>
              </motion.div>
              <motion.div className="timeline-item" initial={{ opacity: 0, x: -20 }} whileInView={{ opacity: 1, x: 0 }} viewport={{ once: true }}>
                <div className="timeline-dot"></div>
                <div className="timeline-card">
                  <h3>Favorite Moments Together</h3>
                  <ul style={{ lineHeight: 1.8, color: "rgba(250,250,250,0.8)", paddingLeft: "18px" }}>
                    <li>Watching Stranger Things together üì∫</li>
                    <li>Our movie night watching Sirai üé¨</li>
                    <li>Coffee dates ‚òï</li>
                    <li>Adventures to Kodaikanal & Kerala üèîÔ∏è</li>
                  </ul>
                </div>
              </motion.div>
            </div>
          </Element>

          <Element name="quiz" className="section">
            <motion.div initial={{ opacity: 0, y: 20 }} whileInView={{ opacity: 1, y: 0 }} viewport={{ once: true }}>
              <h2 className="gradient-text">How Well Do You Know Us?</h2>
              <p style={{ marginTop: "12px", maxWidth: "640px", lineHeight: 1.7 }}>
                A playful quiz to prove you know every detail of our love story.
              </p>
              <div className="progress-bar" style={{ marginTop: "16px" }}>
                <span style={{ width: `${(score / totalQuestions) * 100}%` }}></span>
              </div>
              <p style={{ marginTop: "10px", fontSize: "0.9rem", color: "rgba(250,250,250,0.7)" }}>
                Score: {score}/{totalQuestions}
              </p>
            </motion.div>
            <div className="quiz-grid">
              {quizQuestions.map((question, index) => (
                <QuizCard
                  key={question.id}
                  question={question}
                  index={index}
                  total={totalQuestions}
                  answers={answers}
                  setAnswers={setAnswers}
                />
              ))}
            </div>
            <motion.div initial={{ opacity: 0 }} whileInView={{ opacity: 1 }} transition={{ duration: 0.6 }}>
              <h3 className="gradient-text">You got {score}/{totalQuestions}! You know us perfectly! üíï</h3>
              {score === totalQuestions ? (
                <button
                  type="button"
                  className="btn btn-primary"
                  onClick={(event) => {
                    ripple(event);
                    confetti({ particleCount: 140, spread: 80, origin: { y: 0.7 } });
                    scroller.scrollTo("question", { smooth: true, offset: -40 });
                  }}
                  style={{ marginTop: "16px" }}
                >
                  Something Special Awaits...
                </button>
              ) : null}
            </motion.div>
          </Element>

          <Element name="question" className="section big-question">
            <motion.div initial={{ opacity: 0, y: 30 }} whileInView={{ opacity: 1, y: 0 }} transition={{ duration: 0.8 }}>
              <p className="eyebrow">Before we start our forever journey...</p>
              <h2 className="gradient-text">{typedText}</h2>
              <div className="buttons">
                <button className="btn yes-btn" onClick={(event) => { ripple(event); handleYes(); }}>YES</button>
                {!noHidden ? (
                  <button
                    className="no-btn"
                    style={{ transform: `translate(${noPos.x}px, ${noPos.y}px) scale(${noPos.scale})`, transition: `transform ${Math.max(0.05, 0.2 - noAttempts * 0.03)}s ease` }}
                    onMouseEnter={moveNo}
                    onClick={moveNo}
                  >
                    No
                  </button>
                ) : null}
              </div>
              <p style={{ color: "rgba(250,250,250,0.7)", marginTop: "10px" }}>
                (Tip: the NO button is playful üòÑ)
              </p>
            </motion.div>
          </Element>

          <AnimatePresence>
            {showReveal ? (
              <Element name="reveal" className="section">
                <motion.div
                  className="reveal glass"
                  initial={{ opacity: 0, y: 30 }}
                  animate={{ opacity: 1, y: 0 }}
                  exit={{ opacity: 0 }}
                  transition={{ duration: 0.8 }}
                  style={{ padding: "32px" }}
                >
                  <h2 className="gradient-text">Our Forever Starts Here</h2>
                  <p style={{ lineHeight: 1.8 }}>
                    From that first day on October 12, <br />
                    To our special November 20, <br />
                    Every coffee date, every Stranger Things episode, <br />
                    Every adventure from Kodaikanal to Kerala, <br />
                    Every moment with you has been perfect. <br /><br />
                    You're my favorite person, <br />
                    My Korean food buddy, <br />
                    My Sirai movie partner, <br />
                    My everything. <br /><br />
                    Will you be my Valentine? ‚ù§Ô∏è
                  </p>
                  <div className="carousel">
                    <div className="carousel-frame">
                      <AnimatePresence mode="wait">
                        <motion.img
                          key={gallerySlides[galleryIndex].label}
                          src={gallerySlides[galleryIndex].src}
                          alt={gallerySlides[galleryIndex].label}
                          loading="lazy"
                          initial={{ opacity: 0, scale: 1.02 }}
                          animate={{ opacity: 1, scale: 1 }}
                          exit={{ opacity: 0, scale: 0.98 }}
                          transition={{ duration: 0.5 }}
                        />
                      </AnimatePresence>
                    </div>
                    <div className="carousel-controls">
                      <button className="btn btn-outline" onClick={(event) => { ripple(event); prevSlide(); }}>
                        Previous
                      </button>
                      <span className="pill">{gallerySlides[galleryIndex].label}</span>
                      <button className="btn btn-outline" onClick={(event) => { ripple(event); nextSlide(); }}>
                        Next
                      </button>
                    </div>
                  </div>
                  <div className="cta-row">
                    <button className="btn btn-primary" onClick={(event) => { ripple(event); handleDownload(); }}>
                      Download Our Memories
                    </button>
                    <button className="btn btn-outline" onClick={(event) => { ripple(event); handleShare(); }}>
                      Share the Love
                    </button>
                  </div>
                </motion.div>
              </Element>
            ) : null}
          </AnimatePresence>

          <footer style={{ textAlign: "center", color: "rgba(250,250,250,0.6)" }}>
            Crafted in black & rose gold for a once-in-a-lifetime proposal.
          </footer>

          {toast ? <div className="toast">{toast}</div> : null}
          {secretOpen ? (
            <div className="hidden-gallery" onClick={() => setSecretOpen(false)}>
              <div className="panel">
                <h2 className="gradient-text">Secret Message</h2>
                <p>Every moment with you is a quiet miracle. Thank you for choosing this love. ‚ú®</p>
                <p style={{ color: "rgba(250,250,250,0.7)" }}>Tap anywhere to close.</p>
              </div>
            </div>
          ) : null}
          <audio ref={audioRef} src="https://cdn.pixabay.com/download/audio/2022/11/03/audio_f059e90c87.mp3?filename=forever-126280.mp3" loop preload="none"></audio>
        </div>
      );
    };

    const Gallery = () => (
      <div className="hidden-gallery" onDoubleClick={() => window.history.back()}>
        <div className="panel">
          <h2 className="gradient-text">Hidden Gallery ‚ú®</h2>
          <p>Double-click anywhere to return. Add your private photos here for an even sweeter surprise.</p>
          <div className="gallery">
            {["Secret smile", "Promise ring", "Midnight walk", "Handwritten notes"].map((label) => (
              <div key={label} className="gallery-item">{label}</div>
            ))}
          </div>
        </div>
      </div>
    );

    const App = () => (
      <HashRouter>
        <Particles />
        <Routes>
          <Route path="/" element={<Home />} />
          <Route path="/gallery" element={<Gallery />} />
        </Routes>
      </HashRouter>
    );

    const root = createRoot(document.getElementById("root"));
    root.render(<App />);

    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("/sw.js").catch(() => {});
      });
    }
  </script>
  <style>
    @keyframes ripple {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }
  </style>
</body>
</html>
